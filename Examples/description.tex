\documentclass[a4paper,cleardoubleempty]{scrreprt}
\usepackage{amsmath,amssymb}
\usepackage[pdftex,bookmarks=false,pdfpagelabels=true,plainpages=false]{hyperref}
\usepackage{booktabs}
\usepackage{makeidx}
%\usepackage{sfmath}
\newtheorem{Problem}{Problem}[section]

\newcommand{\todo}[1]{\textbf{\textsc{\textcolor{black}{TODO: #1}}}}


\makeindex

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
\title{DOpE - Deal Optimization Environment}
\author{
  Michael Geiger\thanks{University of Heidelberg, 
    {michael.geiger@iwr.uni-heidelberg.de}}, 
  Christian Goll\thanks{University of Heidelberg, 
    {christian.goll@iwr.uni-heidelberg.de}}, 
  Thomas Wick\thanks{University of Heidelberg, 
    {thomas.wick@iwr.uni-heidelberg.de}}, 
  Winnifried Wollner\thanks{University of Hamburg, 
    {winnifried.wollner@math.uni-hamburg.de}}
}



\date{\today}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\maketitle
\cleardoublepage\pagestyle{headings}
\tableofcontents
\cleardoublepage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\include{Documentation/foreword.tex}


\cleardoublepage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Example Handling, Creating new Examples}
To implement new examples or to use existing examples 
from the library for own research, the user 
can simply copy an existing example. In this 
new example, own code and changes can be compiled.

Adding a new regression test to the repository 
needs some concentration of the user. In the 
following, we explain how to do this and what 
\textit{must} be taken into account:
\begin{verbatim}
cp -r Example1 ExampleNew
cd ExampleNew
rm -r CVS
cd Test
rm -r CVS
\end{verbatim}
It is important to remove the repository information,
which is stored in the directory CVS.

Then, we have to consider the following step. In order to 
run the regression tests, we start the executable file
of the present example. This executable comes from the 
Makefile. For example in the Makefile of 
Example \ref{PDE_Stat_Stokes}, 
\begin{verbatim}
target   = $(BINDIR)/DOpE-PDE-StatPDE-Example1-$
           (dope_dimension)d-$(deal_II_dimension)d
\end{verbatim}
and concretely:
\begin{verbatim}
DOpE-PDE-StatPDE-Example1-2d-2d
\end{verbatim}
The aforementioned expression is the name of 
the executable that is required to run the 
regression test. Hence, in 
\begin{verbatim}
PDE/StatPDE/Example1/Test> emacs test.sh
\end{verbatim}
you find two times the line
\begin{verbatim}
echo "Running Program 
     ../../../../../bin/DOpE-PDE-StatPDE-Example1-2d-2d test.prm"
     (../../../../../bin/DOpE-PDE-StatPDE-Example1-2d-2d test.prm 2>&1) 
     > /dev/null
\end{verbatim} 
It is really important when copying an existing example,
to change this information. 
First, we have to change the target in the Makefile
\begin{verbatim}
target   = $(BINDIR)/DOpE-PDE-StatPDE-ExampleNew-$
           (dope_dimension)d-$(deal_II_dimension)d
\end{verbatim}
Second, we have to replace 
Example1 by ExampleNew such that 
\begin{verbatim}
echo "Running Program 
     ../../../../../bin/DOpE-PDE-StatPDE-ExampleNew-2d-2d test.prm"
     (../../../../../bin/DOpE-PDE-StatPDE-ExampleNew-2d-2d test.prm 2>&1) 
     > /dev/null
\end{verbatim} 
Please, also change the dimension parameters 
\begin{verbatim}
-2d-2d
\end{verbatim} 
Now, the user is prepared to change any information in the 
\begin{verbatim}
main.cc, localpde.h, functionals.h, localfunctional.h, etc
\end{verbatim} 



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Examples for PDE Solution}
\label{PDE}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Stationary PDEs} 
\label{PDE_Stat}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Stationary Stokes Equations} 
\label{PDE_Stat_Stokes}
\input{PDE/StatPDE/Example1/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Stationary FSI with INH Material} 
\label{PDE_Stat_FSI_INH}
\input{PDE/StatPDE/Example2/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Stationary FSI with STVK Material} 
\label{PDE_Stat_FSI_STVK}
\input{PDE/StatPDE/Example3/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Stationary Elasticity Benchmark} 
\label{PDE_Stat_Elasticity}
\input{PDE/StatPDE/Example4/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Stationary Plasticity Benchmark} 
\label{PDE_Stat_Plasticity}
\input{PDE/StatPDE/Example5/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Stationary Stokes Equations with periodic BC} 
\label{PDE_Stat_Periodic_Stokes}
\input{PDE/StatPDE/Example6/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Laplace Equation in 2D} 
\label{PDE_Stat_Laplace_2D}
\input{PDE/StatPDE/Example7/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Laplace Equation in 3D}
\label{PDE_Stat_Laplace_3D}
\input{PDE/StatPDE/Example8/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Nonstationary PDEs}
\label{PDE_Instat}
\input{PDE/InstatPDE/content.tex}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Nonstationary Stokes Equations}
\label{PDE_Instat_Stokes}
\input{PDE/InstatPDE/Example1/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Nonstationary FSI Problem}
\label{PDE_Instat_FSI}
\input{PDE/InstatPDE/Example2/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Black-Scholes Equation}
\label{PDE_Instat_Black_Scholes}
\input{PDE/InstatPDE/Example3/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Heat Equation in 1D}
\label{PDE_Instat_Heat_1D}
\input{PDE/InstatPDE/Example4/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Heat Equation in 2D with nonlinearity}
\label{PDE_Instat_Heat_2D}
\input{PDE/InstatPDE/Example5/content.tex}
\cleardoublepage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Examples with Optimization}
\label{OPT}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Subject to a Stationary PDE}
\label{OPT_Stat}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Distributed control with a linear elliptic PDE}
\label{OPT_Stat_Distrib_Lin_Ellipt}
\input{OPT/StatPDE/Example1/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Parameter control with a linear elliptic PDE}
\label{OPT_Stat_Param_Lin_Ellipt}
\input{OPT/StatPDE/Example2/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Parameter control with a nonlinear PDE from fluid dynamcis}
\label{OPT_Stat_Param_Nonlin_Fluid}
\input{OPT/StatPDE/Example3/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Control in the dirichlet boundary values}
\label{OPT_Stat_Dirichlet_Boundary}
\input{OPT/StatPDE/Example4/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Distributed Control with Different Meshes for Control and State}
\label{OPT_Stat_Distributed_MultiMesh}
\input{OPT/StatPDE/Example5/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Compliance Minimization of a variable Thickness MBB-Beam}
\label{OPT_Stat_MBB-Beam}
\input{OPT/StatPDE/Example6/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Distributed control with a linear elliptic PDE using SNOPT}
\label{OPT_Stat_Box_controlconstraints_SNOPT}
\input{OPT/StatPDE/Example7/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Topology optimization of an MBB-Beam using SNOPT}
\label{OPT_Stat_TopOpt_MBB_SNOPT}
\input{OPT/StatPDE/Example8/content.tex}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Parameter control with a non-linear PDE from FSI dynamics}
\label{OPT_Stat_Param_Nonlin_FSI}
%\input{OPT/StatPDE/Example5/content.tex}
\clearpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Testing examples}
The DOpE testsuite consists of regression tests. They are run to compare 
the output to previous outputs. This is useful (necessary) after 
changing programming code anywhere in the library. If a test
succeeds, everything is fine in the library. If not, you should not
check in your code into DOpE. Please make sure what is going wrong and WHY!

Every command is computed via a Makefile. In the basic example 
directory

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Where can I find the tests}
In each example directory you find a subdirectory `Test'. Herein, you find 
the parameter files for meshes (*.inp) and a param file (test.prm).
Moreover, the executable is denoted by `test.sh'. Please make sure, that 
the 
\begin{verbatim}
set never_write_list
\end{verbatim}
contains every possible output
\begin{verbatim}
Gradient;Hessian;Tangent;Residual;Update;Control;State
\end{verbatim}
That means, no solution files are written to the output.
Recall, that we are just interested in terminal output that 
is of course sufficient to verify the things.

Hence, the results directory should be empty
\begin{verbatim}
set results_dir   = ./
\end{verbatim}
The rest in the param file must be identically the same as 
in the dope.prm file in the parent directory. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{How to start testing?}
You start testing by typing 
\begin{verbatim}
> ./test.sh Store
\end{verbatim}
in the terminal.

After the run, you have to call 
\begin{verbatim}
> ./test.sh Test
\end{verbatim}
to compare your stored output. Of course, there should be no differences.

The useful point is now the following. After implemention of 
new pieces of code in the DOpE library or in the examples, you can
run 
\begin{verbatim}
> ./test.sh Test
\end{verbatim}
Hereby, you compare your `new' output with the previous stored output.

Attention: After changes you should NOT run again
\begin{verbatim}
> ./test.sh Store
\end{verbatim}
In that case, you overwrite your previous output.
\cleardoublepage





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\addcontentsline{toc}{chapter}{Index}
\printindex

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document}
